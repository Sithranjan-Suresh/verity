<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verity</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --bg2: #111118;
    --bg3: #1a1a24;
    --border: rgba(255,255,255,0.08);
    --text: #f0f0f5;
    --muted: #6b6b80;
    --accent: #7c6dfa;
    --green: #22d48f;
    --yellow: #f5c542;
    --orange: #ff8c42;
    --red: #ff4d6d;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    width: 380px;
    min-height: 200px;
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px 14px;
    border-bottom: 1px solid var(--border);
    background: var(--bg2);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 9px;
  }

  .logo-mark {
    width: 28px;
    height: 28px;
    background: linear-gradient(135deg, var(--accent), #a78bfa);
    border-radius: 7px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 800;
    color: white;
    letter-spacing: -0.5px;
  }

  .logo-text {
    font-size: 17px;
    font-weight: 800;
    letter-spacing: 0.5px;
    background: linear-gradient(90deg, #fff 40%, var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .tag {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* ‚îÄ‚îÄ States ‚îÄ‚îÄ */
  .state { display: none; }
  .state.active { display: block; }

  /* ‚îÄ‚îÄ Home / No YouTube ‚îÄ‚îÄ */
  .no-yt {
    padding: 32px 24px;
    text-align: center;
  }
  .no-yt .icon { font-size: 36px; margin-bottom: 12px; }
  .no-yt h2 { font-size: 15px; font-weight: 700; margin-bottom: 6px; }
  .no-yt p { font-size: 12px; color: var(--muted); line-height: 1.6; }

  /* ‚îÄ‚îÄ API Key Setup ‚îÄ‚îÄ */
  .setup {
    padding: 20px;
  }
  .setup h2 { font-size: 14px; font-weight: 700; margin-bottom: 6px; }
  .setup p { font-size: 11px; color: var(--muted); line-height: 1.5; margin-bottom: 14px; }

  .input-wrap {
    position: relative;
  }
  .input-wrap input {
    width: 100%;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    outline: none;
    transition: border-color 0.2s;
  }
  .input-wrap input:focus { border-color: var(--accent); }
  .input-wrap input::placeholder { color: var(--muted); }

  .btn {
    width: 100%;
    margin-top: 10px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 11px;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    letter-spacing: 0.3px;
  }
  .btn:hover { opacity: 0.88; }
  .btn:active { transform: scale(0.98); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* ‚îÄ‚îÄ Link Picker ‚îÄ‚îÄ */
  .picker { padding: 16px 20px; }
  .picker-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
  }
  .video-title {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 14px;
    line-height: 1.4;
    font-style: italic;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .link-list { display: flex; flex-direction: column; gap: 7px; }

  .link-item {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
  }
  .link-item:hover { border-color: var(--accent); background: rgba(124, 109, 250, 0.07); }
  .link-item.selected { border-color: var(--accent); background: rgba(124, 109, 250, 0.1); }

  .link-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
    transition: background 0.2s;
  }
  .link-item.selected .link-dot { background: var(--accent); }

  .link-text {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1;
  }

  .analyze-btn {
    margin: 14px 20px 16px;
    width: calc(100% - 40px);
  }

  .no-links {
    text-align: center;
    padding: 20px 0;
    font-size: 12px;
    color: var(--muted);
    line-height: 1.6;
  }

  /* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
  .loading-state {
    padding: 32px 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
  }

  .spinner-ring {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 3px solid var(--bg3);
    border-top-color: var(--accent);
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-steps { display: flex; flex-direction: column; gap: 6px; width: 100%; }

  .loading-step {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 11px;
    color: var(--muted);
    transition: color 0.3s;
  }
  .loading-step.done { color: var(--green); }
  .loading-step.active { color: var(--text); }

  .step-icon { width: 16px; font-size: 11px; text-align: center; }

  /* ‚îÄ‚îÄ Results ‚îÄ‚îÄ */
  .results { padding: 0 0 16px; }

  /* Score hero */
  .score-hero {
    padding: 20px 20px 16px;
    display: flex;
    align-items: center;
    gap: 18px;
    border-bottom: 1px solid var(--border);
    background: var(--bg2);
  }

  .score-ring-wrap {
    position: relative;
    width: 72px;
    height: 72px;
    flex-shrink: 0;
  }

  .score-ring-wrap svg {
    width: 72px;
    height: 72px;
    transform: rotate(-90deg);
  }

  .score-ring-bg { fill: none; stroke: var(--bg3); stroke-width: 5; }
  .score-ring-fg {
    fill: none;
    stroke-width: 5;
    stroke-linecap: round;
    stroke-dasharray: 188;
    stroke-dashoffset: 188;
    transition: stroke-dashoffset 1.2s cubic-bezier(0.34, 1.56, 0.64, 1), stroke 0.3s;
  }

  .score-number {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 800;
  }

  .score-info { flex: 1; }

  .verdict-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.8px;
    text-transform: uppercase;
    margin-bottom: 7px;
    border: 1px solid;
  }

  .verdict-dot { width: 6px; height: 6px; border-radius: 50%; }

  .score-domain {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    margin-bottom: 5px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .score-summary {
    font-size: 12px;
    line-height: 1.5;
    color: var(--muted);
  }

  /* Signals */
  .section-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    color: var(--muted);
    padding: 14px 20px 8px;
  }

  .signals { padding: 0 20px; display: flex; flex-direction: column; gap: 6px; }

  .signal-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bg3);
    border-radius: 7px;
    padding: 8px 12px;
    border-left: 2px solid transparent;
    animation: fadeUp 0.4s ease both;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .signal-row.positive { border-left-color: var(--green); }
  .signal-row.neutral { border-left-color: var(--muted); }
  .signal-row.negative { border-left-color: var(--orange); }

  .signal-label { font-size: 11px; color: var(--muted); }
  .signal-value { font-family: 'DM Mono', monospace; font-size: 10px; font-weight: 500; }
  .signal-value.positive { color: var(--green); }
  .signal-value.neutral { color: var(--text); }
  .signal-value.negative { color: var(--orange); }

  /* Risk / Relevance */
  .detail-cards {
    padding: 0 20px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 6px;
  }

  .detail-card {
    background: var(--bg3);
    border-radius: 8px;
    padding: 10px 12px;
    border: 1px solid var(--border);
  }
  .detail-card .dc-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 5px;
  }
  .detail-card .dc-text {
    font-size: 12px;
    line-height: 1.5;
    color: var(--text);
  }
  .detail-card.risk .dc-text { color: var(--orange); }

  /* Redirect chain */
  .chain-wrap { padding: 0 20px; margin-top: 6px; }
  .chain-row {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    padding: 4px 0;
    line-height: 1.4;
    overflow: hidden;
  }
  .chain-row .arrow { color: var(--accent); flex-shrink: 0; margin-top: 1px; }
  .chain-url { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }

  /* Back button */
  .back-btn {
    margin: 10px 20px 0;
    width: calc(100% - 40px);
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-size: 12px;
  }
  .back-btn:hover { border-color: var(--muted); color: var(--text); opacity: 1; }

  /* Error */
  .error-state {
    padding: 24px 20px;
    text-align: center;
  }
  .error-icon { font-size: 32px; margin-bottom: 10px; }
  .error-msg { font-size: 12px; color: var(--orange); line-height: 1.5; }
  .error-detail { font-family: 'DM Mono', monospace; font-size: 10px; color: var(--muted); margin-top: 8px; }

  /* Color helpers */
  .color-green { color: var(--green); }
  .color-yellow { color: var(--yellow); }
  .color-orange { color: var(--orange); }
  .color-red { color: var(--red); }

  /* ‚îÄ‚îÄ History ‚îÄ‚îÄ */
  #history-section { border-top: 1px solid var(--border); margin-top: 12px; padding-top: 12px; }
  .history-label {
    font-size: 10px; font-weight: 600; letter-spacing: 1.2px; text-transform: uppercase;
    color: var(--muted); padding: 0 20px 8px;
  }
  .history-list { display: flex; flex-direction: column; gap: 5px; padding: 0 20px; padding-bottom: 4px; }
  .history-item {
    display: flex; align-items: center; gap: 10px;
    background: var(--bg3); border-radius: 7px; padding: 7px 10px;
    cursor: pointer; border: 1px solid var(--border); transition: border-color 0.2s;
  }
  .history-item:hover { border-color: var(--muted); }
  .history-score {
    font-size: 13px; font-weight: 800; width: 32px; height: 32px;
    border-radius: 50%; border: 2px solid; display: flex; align-items: center;
    justify-content: center; flex-shrink: 0;
  }
  .history-info { flex: 1; overflow: hidden; }
  .history-domain { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .history-meta { font-size: 10px; color: var(--muted); margin-top: 2px; }

  /* ‚îÄ‚îÄ Mismatch badge ‚îÄ‚îÄ */
  .mismatch-badge {
    display: none; align-items: center; gap: 7px;
    margin: 10px 20px 0;
    background: rgba(255,140,66,0.1); border: 1px solid rgba(255,140,66,0.3);
    border-radius: 7px; padding: 8px 12px;
    font-size: 11px; font-weight: 700; color: var(--orange);
    animation: fadeUp 0.3s ease;
  }

  /* ‚îÄ‚îÄ Share button ‚îÄ‚îÄ */
  .share-btn {
    margin: 8px 20px 0;
    width: calc(100% - 40px);
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-size: 12px;
    transition: all 0.2s;
  }
  .share-btn:hover { border-color: var(--accent); color: var(--accent); opacity: 1; }

</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="logo">
    <img src="icons/verity_logo.jpg" class="logo-mark" style="object-fit:cover;border-radius:7px;width:28px;height:28px;">
    <span class="logo-text">Verity</span>
  </div>
  <span class="tag">Trust Layer</span>
</div>

<!-- STATE: Not on YouTube -->
<div id="state-no-yt" class="state">
  <div class="no-yt">
    <div class="icon">üì∫</div>
    <h2>Open a YouTube video</h2>
    <p>Verity analyzes sponsor links found in YouTube video descriptions. Navigate to any YouTube video and click the extension again.</p>
  </div>
</div>

<!-- STATE: API Key Setup -->
<div id="state-setup" class="state">
  <div class="setup">
    <h2>Enter your Groq API Key</h2>
    <p>Verity uses Groq (free, no credit card) to score sponsor credibility. Get a free key at <strong>console.groq.com</strong> ‚Üí API Keys ‚Üí Create. Stored locally only.</p>
    <div class="input-wrap">
      <input type="password" id="api-key-input" placeholder="gsk_..." autocomplete="off">
    </div>
    <button class="btn" id="save-key-btn">Save Key & Continue ‚Üí</button>
  </div>
</div>

<!-- STATE: Link Picker -->
<div id="state-picker" class="state">
  <div class="picker">
    <div class="picker-label">Sponsor Links Found</div>
    <div id="video-title-preview" class="video-title"></div>
    <div id="link-list" class="link-list">
      <!-- populated by JS -->
    </div>
    <div id="no-links-msg" class="no-links" style="display:none">
      No external links found in this video's description. Try expanding the description first.
    </div>
  </div>
  
    <!-- History -->
    <div id="history-section" style="display:none">
      <div class="history-label">Recently Checked</div>
      <div id="history-wrap" class="history-list"></div>
    </div>

  <button class="btn analyze-btn" id="analyze-btn">Analyze Selected Link ‚Üí</button>
</div>

<!-- STATE: Loading -->
<div id="state-loading" class="state">
  <div class="loading-state">
    <div class="spinner-ring"></div>
    <div class="loading-steps">
      <div class="loading-step" id="step-domain">
        <span class="step-icon">‚è≥</span>
        <span>Looking up domain age & registration...</span>
      </div>
      <div class="loading-step" id="step-redirect">
        <span class="step-icon">‚è≥</span>
        <span>Tracing redirect chain...</span>
      </div>
      <div class="loading-step" id="step-ai">
        <span class="step-icon">‚è≥</span>
        <span>Scoring credibility with AI...</span>
      </div>
    </div>
  </div>
</div>

<!-- STATE: Results -->
<div id="state-results" class="state">
  <div class="results">

    <!-- Score Hero -->
    <div class="score-hero">
      <div class="score-ring-wrap">
        <svg viewBox="0 0 72 72">
          <circle class="score-ring-bg" cx="36" cy="36" r="30"/>
          <circle class="score-ring-fg" id="score-ring" cx="36" cy="36" r="30"/>
        </svg>
        <div class="score-number" id="score-number">‚Äì</div>
      </div>
      <div class="score-info">
        <div id="verdict-badge" class="verdict-badge">
          <div class="verdict-dot" id="verdict-dot"></div>
          <span id="verdict-text">‚Äì</span>
        </div>
        <div id="mismatch-badge" class="mismatch-badge"></div>
        <div class="score-domain" id="result-domain">‚Äì</div>
        <div class="score-summary" id="result-summary">‚Äì</div>
      </div>
    </div>

    <!-- Signals -->
    <div class="section-label">Signal Breakdown</div>
    <div id="signals-list" class="signals"></div>

    <!-- Risk + Relevance -->
    <div class="section-label">Details</div>
    <div class="detail-cards">
      <div class="detail-card risk" id="risk-card" style="display:none">
        <div class="dc-label">‚ö† Top Risk</div>
        <div class="dc-text" id="risk-text"></div>
      </div>
      <div class="detail-card" id="relevance-card">
        <div class="dc-label">üéØ Sponsor Relevance</div>
        <div class="dc-text" id="relevance-text"></div>
      </div>
    </div>

    <!-- Redirect Chain -->
    <div class="section-label" id="chain-label" style="display:none">Redirect Chain</div>
    <div class="chain-wrap" id="chain-wrap"></div>

    <button class="btn share-btn btn" id="share-btn">üìã Copy Result Card</button>
    <button class="btn back-btn" id="back-btn">‚Üê Check Another Link</button>
  </div>
</div>

<!-- STATE: Error -->
<div id="state-error" class="state">
  <div class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <div class="error-msg" id="error-msg">Something went wrong analyzing this link.</div>
    <div class="error-detail" id="error-detail"></div>
    <button class="btn" style="margin-top:16px" id="error-back-btn">‚Üê Try Again</button>
  </div>
</div>

<script src="popup.js"></script>
</body>
</html>
